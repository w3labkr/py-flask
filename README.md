[![Build Status](https://travis-ci.com/w3labkr/py-flask.svg?branch=main)](https://travis-ci.com/w3labkr/py-flask)

## Description

The goal of this project is to create a lightweight collaboration framework. For this, it is based on Flask.

## Environment

numpy, pandas, scipy, tqdm, pyarrow,
matplotlib, seaborn, opencv-python
bs4, selenium, chromedriver-autoinstaller,
geopandas, geoplot,
Flask, folium, WTForms, APScheduler,
PyMySQL,
sklearn, tensorflow, auto-sklearn, autokeras,

## Directory Structure

```
o
|-- backend/
|   |-- configs/
|   |-- datasets/
|   |-- executes/
|   |-- middlewares/
|   |-- mls/
|   |-- models/
|   |-- modules/
|   |-- packages/
|   |-- routes/
|   |-- schedules/
|   |-- static/
|   |   `-- none/
|   |       |-- assets/
|   |       |-- downloads/
|   |       `-- vendors/
|   |-- storage/
|   |   `-- anonymous/
|   |-- templates/
|   |   `-- none/
|   |       |-- htmls/
|   |       |-- includes/
|   |       `-- layouts/
|   `-- app.py
`-- frontend/
    `-- index.html
```

**backend**

- The configs directory contains all of your application's configuration files.
- The datasets directory contains the raw data.
- The executes directory contains files that are executed by subprocesses.
- The middleware directory contains decorator files that run before routing.
- The mls directory contains trained machine models.
- The models directory contains files with preprocessing and database workflows.
- The modules directory contains module files used globally.
- The packages directory contains package files for your application.
- The routes directory contains all of the route definitions for your application.
- The schedules directory contains files that run periodically.
- The static directory contains your views as well as un-compiled assets such as CSS or JavaScript.
- The storage directory contains file based sessions, file caches, and other files generated by the framework.
- The templates directory contains dynamically rendered template files.

**frontend**

- This is the directory used when using the react, angular and view framework.

## Settings

Global settings can be set in the app.py.

**app.py**

```python
settings = {
    'theme': 'none',
    'layout': 'content',
    'metadata': {'slug': '', 'current': '', 'parent': '', 'ancestor': ''},
    'navigation': {
        'primary': {'filename': 'navigation', 'title': ''},
        'secondary': {'filename': 'navigation', 'title': ''},
    },
    'sidebar': {
        'primary': {'filename': 'sidebar'},
        'secondary': {'filename': 'sidebar'},
    },
}
```

page settings can be set in the routing file.
**route.py**

```python
def get_index():
  settings.layout = 'content'
```

- theme: none
- layout: content, sidebar-content, content-sidebar, and sidebar-content-sidebar.

**metadata**  
Metadata is generated dynamically within the routing file.

## Usage

### Execute

**Run the script file in the executes directory.**

```python
from modules.flask import subprocess_exec
subprocess_exec('execute.py')
```

**execute.py**

```python
#!/usr/bin/python
def main():
  pass
```

**Run all script files in the executes directory.**

```python
from modules.flask import subprocess_execs
subprocess_execs(excludes=[])
```

### Model

If a file with the same name as the routing file exists in the model directory, it is dynamically imported and assigned to the model variable.

```python
from modules.importlib import import_model
model = import_model(filename)
```

If you have multiple routes in your routing file, you can use a parameter to change the name of the file to import.

```python
from modules.importlib import import_model
model = import_model(filename, suffix='')
```

### Route

File names in the path directory are converted to URL slugs. Double underscores are used as URL slug separators, and single underscores are converted to hyphens and if the filename starts with an underscore, it is not rendered.

```
dirname__dir_name to /dirname/dir-name/
```

To exclude rendering, add the name of the file you want to exclude to the auto_register_blueprint function in app.py.

```python
from modules.flask import auto_register_blueprint
auto_register_blueprint(excludes=['filename'])
```

### Schedule

**app.py**

```python
from schedules.schedule import job1, job2
scheduler.add_job(func=job1, trigger="interval", id='do_job1', seconds=3)
scheduler.add_job(func=job2, trigger="cron", id='do_job2', hour='5', minute='0')
```

**schedule.py**

```python
def job1():
    pass
def job2():
    pass
```

### Template

**Render**  
If there is a file with the same name in the same directory, the file extensions are rendered in the order of html, jinja, and jinja2.

## License

This project is licensed under the [MIT LICENSE](LICENSE).
